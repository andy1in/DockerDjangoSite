{% extends "base.html" %}
{% load static %}

{% block title %}{{ post.title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/article.css' %}">
{% endblock %}

{% block content %}

<div class="layout">

  <!-- LEFT SIDEBAR -->
  <aside class="aside-left" id="aside-left">
    <h3>–í–æ–ø—Ä–æ—Å—ã</h3>

    {% if post.faqs.exists %}
      <div class="course-group">
        {% for faq in post.faqs.all %}
          <a href="{{ faq.get_absolute_url }}"
            class="faq-link {% if faq.id == post.id %}active{% endif %}">
            {{ faq.title }}
          </a>
        {% endfor %}
      </div>
    {% else %}
      <p class="empty">–ü–æ–∫–∞ –Ω–µ—Ç FAQ –¥–ª—è —ç—Ç–æ–π —Å—Ç–∞—Ç—å–∏</p>
    {% endif %}
  </aside>

  <!-- ARTICLE -->
  <article class="article">

    <h1 class="article-title">{{ post.title }}</h1>

    <div class="article-meta">
      <span>{{ post.author }}</span>
      <span>‚Ä¢</span>
      <span>{{ post.date }}</span>
    </div>

    <div class="article-content">
      {{ post.content|safe }}
    </div>

  </article>

  <!-- RIGHT NAVIGATION -->
  <aside class="aside-right" id="aside-right">
    <h3>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>

    <nav class="nav">
      {% for heading in toc %}
        <a href="#{{ heading.id }}">{{ heading.title }}</a>
      {% endfor %}
    </nav>
  </aside>

</div>

<!-- Overlay –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —Å–∞–π–¥–±–∞—Ä–æ–≤ -->
<div class="sidebar-overlay" id="sidebar-overlay"></div>

<!-- –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
<button class="mobile-nav-toggle left" id="toggle-faq" aria-label="–ü–æ–∫–∞–∑–∞—Ç—å FAQ">
  ‚ùì
</button>
<button class="mobile-nav-toggle right" id="toggle-nav" aria-label="–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é">
  üìë
</button>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const asideLeft = document.getElementById('aside-left');
  const asideRight = document.getElementById('aside-right');
  const overlay = document.getElementById('sidebar-overlay');
  const toggleFaq = document.getElementById('toggle-faq');
  const toggleNav = document.getElementById('toggle-nav');

  function closeAll() {
    asideLeft.classList.remove('mobile-visible');
    asideRight.classList.remove('mobile-visible');
    overlay.classList.remove('active');
  }

  toggleFaq.addEventListener('click', function() {
    const isVisible = asideLeft.classList.contains('mobile-visible');
    closeAll();
    if (!isVisible) {
      asideLeft.classList.add('mobile-visible');
      overlay.classList.add('active');
    }
  });

  toggleNav.addEventListener('click', function() {
    const isVisible = asideRight.classList.contains('mobile-visible');
    closeAll();
    if (!isVisible) {
      asideRight.classList.add('mobile-visible');
      overlay.classList.add('active');
    }
  });

  overlay.addEventListener('click', closeAll);

  // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Å—ã–ª–∫—É –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
  document.querySelectorAll('.nav a, .course-group a').forEach(function(link) {
    link.addEventListener('click', closeAll);
  });
});
</script>

{% endblock %}